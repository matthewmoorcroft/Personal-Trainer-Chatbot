\chapter{State of the Art}\label{sec:chap:2}

For the last 40 years society has been living the third industrial revolution, better known as the digital age. Telecommunications and technological innovations are transforming the way people live and work, one way these innovations have impacted society is by allowing users to connect cheaper and quicker internationally, making it easier to share ideas than ever before. 
The ever-growing number of bots assisting humans has allowed companies to automate more and more, relieving people from the most boring of jobs, this has resulted in a higher demand for higher educated workers specially in computer science and other engineering areas. 
As you can see in the graph below, people are becoming more interested in these areas. This helps further develop these technologies as the more people interested, the more ideas are shared and more progress is done.\\

\begin{center}
	\begin{figure}[h!]
		\centering
		\includegraphics[scale=0.6]{./images/3-mach-chat-trend}
		\caption{Global Trends for Machine Learning and Chatbots}
		\label{global-trends-mach-chat}
	\end{figure}
\end{center}

In this chapter the background for the technologies that were used in the project will be explained. \\

\section{Artificial Intelligence}\label{sec:chap3_ai}
As Andrew Ng, a professor from Stanford said, AI is the new electricity, in a certain way the same as electricity changed many industries, AI is set to revolutionize the world. But before explaining further, let’s explain what Artificial Intelligence is. Based on Encyclopaedia Britannica’s definition, AI is the ability for digital computers of performing tasks commonly associated with intelligent beings.  There are two main ways of classifying AI:\\
\begin{itemize}
	\item {\textbf{Type 1:}
		\begin{itemize}
			\item {\textbf{Strong AI:} This is an AI that thinks just like a human. Currently there are no examples of this happening, but its development has accelerated innovations in AI.}
			\item {\textbf{Weak AI:} Build machines that do things like humans but without an understanding of how the human brain works. It is where a machine only is able of doing one task.}
		\end{itemize}
	Companies normally develop a fusion between these two types where machines have a partial understanding of how humans work to do tasks.\\
	}
	\item {\textbf{Type 2:}
		\begin{itemize}
			\item {\textbf{Reactive Machines:} One of the more basic types of Artificial Intelligence. It can’t use past information to do future actions. It focuses more on rules than actual knowledge.}
			\item {\textbf{Limited Memory:} In this case the AI can use past information to do future actions. This design for AI has been integrated in autonomous vehicles, where the car stores information of what occurs in its surroundings. This functionality is used also in chatbots to maintain a contextual idea of the conversation as the machine stores relevant information to make it more human-like.}
			\item {\textbf{Theory of Mind:} This is where a machine can understand and interpret human emotions, beliefs, thoughts, etc. By understanding what makes us human it can be able to socially interact with them. This would be the next level for chatbots, now the machine can extract a person’s emotion by the words and tone spoken with and respond differently based on that, but still has a way to go to understanding humans.}
			\item {\textbf{Self-awareness:} Still in the science fiction stage where a machine is conscious, intelligent and aware, basically a human being. If human kind reaches this point in AI, it would be a huge milestone for the field but will also raise many questions.}
		\end{itemize}
	}
\end{itemize}

Many people confuse Artificial Intelligence with machine learning, but this is wrong, machine learning is a part of AI, many other areas encompass the whole of AI. To visualize this easier the image before shows you how 	this areas are divided.\cite{ai}\\

\begin{center}
	\begin{figure}[h!]
		\centering
		\includegraphics[scale=0.5]{./images/3-ai-areas}
		\caption{Areas in Artificial Intelligence}
		\label{ai-areas}
	\end{figure}
\end{center}

For this project the main areas that were used from AI are Machine Learning and Natural Language Processing. For a final product, speech would be an upgrade to the project to make it able to interact through voice with the user.\\

\begin{itemize}
	\item {\textbf{Machine Learning:} For this project we use supervised training where the bot has conversations with a trainer that tells what the bot should do based on what the user says.}
	\item {\textbf{Natural Language Processing:} Even though many of the tools provided are integrated in Rasa, several tools where used for the bot to work in the initial iteration of the chatbot and still requires tweaking with Rasa.\\
		
		\begin{itemize}
			\item {\textbf{Content Extraction:} This is where valuable information is extracted from what the user says, this can be what can of training they are seeking, at what time they want to be reminded to take their measurements or when the user was born. This is done by using regular expressions or by using lists with synonyms, depending of what type of info is extracted.}
			\item {\textbf{Classification:} Depending on what the user says, the bot must understand what his intentions are, this is done by training the bot with training phrases that reflect what does the user want and associating it with an intention, after training a model, the bot is able to distinguish between different intentions. Before training the bot, human phrases must be translated to something the machine can understand.}
		\end{itemize}
			}
\end{itemize}

\section{Programming Languages}\label{sec:chap3_prog_lang}

\section{Chatbots}\label{sec:chap3_ai}
A chatbot is a software based on AI that simulates a human conversation with a user. This is done through messaging applications such as Telegram, Facebook, websites or company’s messaging software.\\

Chatbots have been slowly but steadily been incorporated into people’s lives, from basic robo-calls to natural speaking bots used in customer service. Virtual assistants such as Google or Alexa, that are constantly getting feature updates making bigger the number of things they can do, such as ordering pizza or getting a booking for a restaurant. These improvements have to do with many of the technologies involved, that have improved greatly. We will explain below the different components in a chatbot and how its architecture has evolved.\\

\subsection{Messaging Platform}\label{sec:chap3_cha_mes_pla}
The messaging app is where the user interacts with the chatbot. As mentioned previously there are several ways of communicating with the chat bot, it can be written or spoken. Depending on how the user talks with the chat bot there will be additional processing, because if the user uses spoken language it must be transcribed for the machine to understand.\\

\subsection{Natural Language Processor}\label{sec:chap3_cha_nlp}
The Natural Language Processor is the step where the bot does most of the work. When the message is received it goes through a series of conversions.\\

\begin{itemize}
	\item {\textbf{Speech to Text:} This is needed only when the message sent from the user is in voice format, such as the virtual assistants solutions provided by Google or Amazon, although this can also be included in applications where voice messages functionality is available.}
	\item {\textbf{Language Detection:} This is a way of building a multilingual chatbot without the need of building different models for every language. The issue is how to get the translation, there is a well-known API from google that provides this functionality for a price. A way to reduce costs can be to have a cache store the most frequent translations.}
	\item {\textbf{Tokenizing:} In this step what the bot does is separate the phrases in independent words, it is also important for the bot to understand what each word is, if it is a noun, verb, adjective or an adverb. Also, it must discard all redundant words that don’t provide any additional information.}
	\item {\textbf{Stemming:} This consists in simplifying the words in the phrase in order to have a much simpler vocabulary for the bot to understand, this is done by eliminating verb conjugations or keeping the stem of the word. In the image below there is a more in detail example of what stemming is.\cite{cha-stem}}
	
	\begin{center}
		\begin{figure}[h!]
			\centering
			\includegraphics[scale=0.7]{./images/3-chatbot-stemming}
			\caption{Stemming Examples}
			\label{cha_stem}
		\end{figure}
	\end{center}

	\item {\textbf{Word to number:} The bot in at this point translates the tokenized and stemmed words into numbers the bot can understand, this is done in two steps.\\
			\begin{itemize}
				\item {\textbf{Word Identifier:} In this step what the bot does is convert each word with a numerical identifier. In this way, for example all the hello’s will be number 1. This helps the bot in the next step.}
				\item {\textbf{Term Frequency:} Here what the bot does is check the frequency of certain words in the training data. This will be used to help classify as some words are more frequent in some intents more than in others.}
			\end{itemize}	
		}
	\item {\textbf{Intent detection:} Based on the frequency words show up on the user’s message the bot can predict what the user’s intention is.}
	\item {\textbf{Entity Extraction:} Once the intent is predicted the next step is extracting the information that is relevant to that intent, in case of setting a reminder for example it is important for the bot to understand at what time does the user wants to be reminded.\\
	This can be done in several ways:\\ 
			\begin{itemize}
				\item {Regular expressions to extract information that comes in certain formats.}
				\item {Lists for finite proper names, like cities or countries.}
				\item {By adding many examples of the data that you want the bot to extract.}
				\item {Filling the missing information with user relevant info extracted in previous occasions.}
				\item {Asking the user for the missing information.}
			\end{itemize}
		}
	\item {\textbf{Response:} After extracting all the relevant information from the user’s message create a response that answers the user’s request and perform whichever action needs to be performed.}
\end{itemize}

\subsection{Profiler}\label{sec:chap3_cha_pro}
The profiler is an extension of the chatbot that allows it to become much more intuitive and natural with the conversations. What the profiler does is gather information from the user through their previous conversations, then uses that info to give context to the user’s requests or fills out missing information based on the user’s preferences.\\

For example, in this project when the user asks to be reminded to take his measurements at 8 am, the bot will extract that information for future occasions. If after that interaction the user asks to be reminded the next day the bot will automatically use the hour extracted from the previously without asking the user for that information.\\

\begin{center}
	\begin{figure}[h!]
		\centering
		\includegraphics[scale=0.6]{./images/3-cha-struct}
		\caption{Chatbot Architecture}
		\label{cha_struct}
	\end{figure}
\end{center}

\section{Chatbot Platforms}\label{sec:chap3_plat}

There are many platforms to build chatbots, with their own features. Below there is a table of the difference between several solutions. In this section we will talk about some of them and what differences each have.\\


\begin{table}[h!]
	\centering
	\resizebox{\linewidth}{!}{%
		\begin{tabular}{|c|c|c|c|c|} 
			\hline
			\rowcolor[rgb]{0.753,0.753,0.753} Bot Name                                                               & Features                                                                                                                                                                                                                                           & Technical Details                                                                                                                                                                           & License                                                                                                                                  & Channel                                                        \\ 
			\hline
			\begin{tabular}[c]{@{}c@{}}IBM Watson \\Conversation Service \end{tabular}                               & \begin{tabular}[c]{@{}c@{}}Has three main components: \\Intents, \\Entities, \\Dialog\\ \\ Analysis, to detect what\\~messages confuse the bot \end{tabular}                                                                                       & \begin{tabular}[c]{@{}c@{}}Built on a neural network \\(one billion Wikipedia words). \end{tabular}                                                                                         & \begin{tabular}[c]{@{}c@{}}Free, priced \\per message,\\ \\ Contact required \\for enterprise \end{tabular}                              & \begin{tabular}[c]{@{}c@{}}Voice\\ Image\\ Text \end{tabular}  \\ 
			\hline
			Wit.ai                                                                                                   & \begin{tabular}[c]{@{}c@{}}Home automation\\ \\ Wearables\\ \\ Hardware \end{tabular}                                                                                                                                                              & \begin{tabular}[c]{@{}c@{}}Allows to use:\\ \\ Entities\\ Intents\\ Context\\ Actions \end{tabular}                                                                                         & Free                                                                                                                                     & \begin{tabular}[c]{@{}c@{}}Voice\\ Text \end{tabular}          \\ 
			\hline
			Rasa                                                                                                     & \begin{tabular}[c]{@{}c@{}}Interactive Learning\\ \\ Stories \end{tabular}                                                                                                                                                                         & \begin{tabular}[c]{@{}c@{}}Modular Pipeline to \\design what best fits for you \end{tabular}                                                                                                & Open Source                                                                                                                              & Text                                                           \\ 
			\hline
			Dialogflow                                                                                               & \begin{tabular}[c]{@{}c@{}}Intuitive Platform\\ \\ Pretrained packages \\from Google\\ \\ Chit Chat built in \end{tabular}                                                                                                                         & \begin{tabular}[c]{@{}c@{}}Neural Network\\ \\ Black box \end{tabular}                                                                                                                      & \begin{tabular}[c]{@{}c@{}}Free\\ Enterprise \end{tabular}                                                                               & \begin{tabular}[c]{@{}c@{}}Voice\\ Text \end{tabular}          \\ 
			\hline
			\begin{tabular}[c]{@{}c@{}}Microsoft Language \\Understanding\\~Intelligent Service (LUIS) \end{tabular} & \begin{tabular}[c]{@{}c@{}}All LUIS applications are \\centered around a \\domain-specific topic or\\ content related.\\ \\ Active learning.\\ \\ You can use pre-existing, \\world-class, pre-built \\models from Bing and Cortana. \end{tabular} & \begin{tabular}[c]{@{}c@{}}LUIS offers a set of \\programmatic REST APIs \\that can be used by\\ developers to automate \\the application creation process. \end{tabular}                   & \begin{tabular}[c]{@{}c@{}}Free\\{[}10.000 Transactions]\\Paid\\{[}1,50\$1.000 transactions]\\{[}4,50\$ 1.000transactions]~\end{tabular} & \begin{tabular}[c]{@{}c@{}}Voice\\ Text \end{tabular}          \\ 
			\hline
			Pandorabots                                                                                              & \begin{tabular}[c]{@{}c@{}}AIML (Artificial Intelligence \\Markup Language) \\ \\ Includes A.L.I.C.E. \end{tabular}                                                                                                                                & \begin{tabular}[c]{@{}c@{}}The Pandorabots API allows \\you to integrate our bot \\hosting service and\\ \\ natural language \\processing engine into \\your own application. \end{tabular} & \begin{tabular}[c]{@{}c@{}}Free\\Developer [19\$/month]\\Pro [199\$/month]\\~Enterprise [Sales]~ ~~\end{tabular}                         & Text                                                           \\
			\hline
		\end{tabular}
	
	}
\label{cha_diff}
\caption{Differences between different chatbot solutions}
\end{table}
 

\subsection{DialogFlow}\label{sec:chap3_dialog}

Dialogflow is Google’s solution for chatbots. It is a framework that uses Google’s ML expertise and offers the user an attractive and intuitive web design. It let’s the user create a chatbot that can interpret text and voice.\\
The difference between Dialogflow and Rasa is that the latter gives the developer more freedom when creating the brains of the chatbot, this can be good or bad. For it to be good, it requires lots of data and knowledge in the field. The advantage Dialogflow has over Rasa for less technical people, is that everything done with the NLU Engine is mostly done already, that leaves the developers with teaching the bot how they want it to perform.\cite{dialogflow}\\

The core functionality is composed of several components:\\
\begin{itemize}
	\item {\textbf{Events:} These are actions that are taken based on the intent, they depend on what the developer wants to do with the chatbot.}
	\item {\textbf{Entities:} Like many chatbot frameworks, entities are the information that the bot must extract from a phrase.}
	\item {\textbf{Context:} In Dialogflow there are two types of context, input context and output context.\\
			\begin{itemize}
				\item {Input Context is a required condition that must be set in in order to trigger the intent. An example would be after setting one alarm, the user asks to set another one. If it wasn’t for the previous context the chatbot would have a hard time understanding it.}
				\item {Output Context is what the intent sets after being triggered for the chatbot to understand what has happened before.}
			\end{itemize}
			}
	\item {\textbf{Intents:} The action the user wants to perform. In Dialogflow all intents are managed with an interface where the developers add the intent it wants predicted and chooses what context, event or entities they want extracted.}
\end{itemize}

\clearpage

\subsection{Rasa}\label{sec:chap3_rasa}

\begin{center}
	\begin{figure}[h!]
		\centering
		\includegraphics[scale=0.4]{./images/3-rasa-log}
		\caption{Rasa Logo}
		\label{rasa_logo}
	\end{figure}
\end{center}

Rasa is an open source platform that offers several tools to build a contextual chatbot, in other words, a bot that can maintain a history of what the user says.\\
The reason for choosing this platform to build the chatbot is that it is open source, free and has the features required, which are:

\begin{itemize}
	\item Option to choose a customized pipeline, modifying it to improve the bot’s accuracy.
	\item Tools to build the chatbot with pretrained entities or custom ones.
	\item Built in system to maintain the context in a conversation.
	\item Tool that allows the user to teach the chatbot through conversation.
	\item Ability to connect to messaging applications.
	\item Tool to create custom actions to certain intents.
	\item Ability of using reminders to send messages to user’s at certain times.
\end{itemize}
	
The problem with using this solution is that you are limited by what is available and what functionality you can add, another limitation compared to Dialogflow is that the only support you can get comes from the users, this isn’t to helpful when you need urgent assistance as you have to wait for a user to answer. Even though there is documentation to assist developers when creating the chatbot the documentation lacks many details on how many things are done and. what the best practices are. This depending on how much Rasa grows, might improve over time.\\
There are two main components in rasa, NLU and CORE, each can work independently if the client’s requirements needs it or they can work together. We will explain how each component works.\cite{rasa}

\subsubsection{NLU}\label{sec:chap3_rasa_nlu}

Rasa NLU is an open-source natural language processing tool for intent classification and entity extraction in chatbots.  From the user’s message it translates it to a JSON data object with the intent predicted and the entities extracted from the message.\\

For example, from the following message it returns the data structure shown below. With intent, search\_restaurant and entities cuisine and location.

\begin{lstlisting}
message = "I am looking for a Mexican restaurant in the center of town"

response = {
	"intent": "search_restaurant",
	"entities": {
		"cuisine" : "Mexican",
		"location" : "center"
	}
}

\end{lstlisting}

The benefits of Rasa NLU when comparing it to Dialogflow is that you can choose your own pipeline. A pipeline is a series of components that together create the Natural Language Processor. There are components for intent classification, components for entity extraction and preprocessing. Each component sends it’s output to the next output to extract all relevant information from the message, so even though there are several components there will only be one output as shown below.

\begin{center}
	\begin{figure}[h!]
		\centering
		\includegraphics[scale=0.4]{./images/3-rasa-pipe}
		\caption{Rasa Pipeline}
		\label{rasa_pipe}
	\end{figure}
\end{center}

There are two main pipelines already built and ready to use with Rasa.
\begin{itemize}
	\item {\textbf{pretrained\_embeddings\_spacy:} This pipeline comes with the word vectors, relation between words in a given context, already trained which makes this a very good pipeline for a short training list, less than 1000.}
	\item {\textbf{supervised\_embeddings:} This is different than the pipeline above in the way that it isn’t pretrained which means that it will create the word vectors based on the dataset available, this is only recommended when a larger dataset is available as it requires a lot of data to interpret it correctly
		}
\end{itemize}
There are custom pipelines, where you create it based on what components the developer wants to have. Adding components for sentiment analysis or different components to classify intents.

\subsubsection{CORE}\label{sec:chap3_rasa_core}

Rasa Core is a dialogue engine used for building virtual assistants, it has several parts that makes treating conversations easier.
\begin{itemize}
	\item {\textbf{Stories:} This is the main component of the core, it is a representation of the conversation flow, with intents and actions. This teaches the bot to know what actions to perform depending on what the user says. Below there is an example of how a story looks like.
	\begin{lstlisting}
	## story_07715946    <!-- name of the story - just for debugging -->
	* greet
	- action_ask_howcanhelp
	* inform{"location": "rome", "price": "cheap"}  <!-- user utterance, in format intent{entities} -->
	- action_on_it
	- action_ask_cuisine
	* inform{"cuisine": "spanish"}
	- action_ask_numpeople        <!-- action that the bot should execute -->
	* inform{"people": "six"}
	- action_ack_dosearch
	
	\end{lstlisting}
	}
	\item {\textbf{Slots:} This is the chatbots memory, it is a way of controlling the context of the conversation as the bot can remember what information the user has said previously and guide the user and/or perform some action based on the information.}
	\item {\textbf{Forms:} A very useful tool that allows the bot to extract information from the user, the difference with setting the slots is that with forms it is quicker to setup for when the bot needs several elements of information as it checks if the user has said any relevant information in the message. For the case, “I want to book a Chinese restaurant for 8” the form will extract “Chinese” and “8” and will only ask the user for the missing information for the booking.}
	\item {\textbf{Actions:} This is something performed in the background that may be search something in a DB, call an API or setting slots.}
	\item {\textbf{Interactive learning:} When adding more complexity to the chatbot this becomes a very useful way of training it as the developer maintains a conversation with the bot and teaches it what to do depending on the conversation flow.}
\end{itemize}

\section{Database}\label{sec:chap3_db}

\section{RaspberryPie}\label{sec:chap3_rasp}
	
\section{Cloud Services}\label{sec:chap3_cloud}

